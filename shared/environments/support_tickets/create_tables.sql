USE ROLE {admin_role};
USE WAREHOUSE {warehouse};

CREATE OR REPLACE TABLE {database}.{raw_schema}.CUSTOMERS (
    CUSTOMER_ID INT,
    CUSTOMER_NAME VARCHAR(200),
    EMAIL VARCHAR(200),
    PHONE VARCHAR(50),
    SSN VARCHAR(11),
    DATE_OF_BIRTH DATE,
    ADDRESS VARCHAR(500),
    CITY VARCHAR(100),
    STATE VARCHAR(50),
    ZIP_CODE VARCHAR(10),
    CREATED_AT TIMESTAMP_NTZ DEFAULT CURRENT_TIMESTAMP()
);

INSERT INTO {database}.{raw_schema}.CUSTOMERS
SELECT
    SEQ4() AS CUSTOMER_ID,
    'Customer_' || SEQ4()::VARCHAR AS CUSTOMER_NAME,
    'user' || SEQ4()::VARCHAR || '@example.com' AS EMAIL,
    '+1-555-' || LPAD(UNIFORM(1000000, 9999999, RANDOM())::VARCHAR, 7, '0') AS PHONE,
    LPAD(UNIFORM(100, 999, RANDOM())::VARCHAR, 3, '0') || '-' ||
        LPAD(UNIFORM(10, 99, RANDOM())::VARCHAR, 2, '0') || '-' ||
        LPAD(UNIFORM(1000, 9999, RANDOM())::VARCHAR, 4, '0') AS SSN,
    DATEADD(DAY, -UNIFORM(7000, 25000, RANDOM()), CURRENT_DATE()) AS DATE_OF_BIRTH,
    UNIFORM(100, 9999, RANDOM())::VARCHAR || ' Main St' AS ADDRESS,
    'City_' || UNIFORM(1, 50, RANDOM())::VARCHAR AS CITY,
    'State_' || UNIFORM(1, 50, RANDOM())::VARCHAR AS STATE,
    LPAD(UNIFORM(10000, 99999, RANDOM())::VARCHAR, 5, '0') AS ZIP_CODE,
    DATEADD(DAY, -UNIFORM(0, 365, RANDOM()), CURRENT_TIMESTAMP()) AS CREATED_AT
FROM TABLE(GENERATOR(ROWCOUNT => 500));

CREATE OR REPLACE TABLE {database}.{raw_schema}.ORDERS (
    ORDER_ID INT,
    CUSTOMER_ID INT,
    ORDER_DATE DATE,
    TOTAL_AMOUNT DECIMAL(10,2),
    STATUS VARCHAR(20),
    PRODUCT_CATEGORY VARCHAR(50),
    CREATED_AT TIMESTAMP_NTZ DEFAULT CURRENT_TIMESTAMP()
);

INSERT INTO {database}.{raw_schema}.ORDERS
SELECT
    SEQ4() AS ORDER_ID,
    UNIFORM(0, 499, RANDOM()) AS CUSTOMER_ID,
    DATEADD(DAY, -UNIFORM(0, 365, RANDOM()), CURRENT_DATE()) AS ORDER_DATE,
    ROUND(UNIFORM(10, 5000, RANDOM())::DECIMAL(10,2) / 100, 2) AS TOTAL_AMOUNT,
    CASE UNIFORM(1, 4, RANDOM())
        WHEN 1 THEN 'completed'
        WHEN 2 THEN 'pending'
        WHEN 3 THEN 'shipped'
        ELSE 'returned'
    END AS STATUS,
    CASE UNIFORM(1, 5, RANDOM())
        WHEN 1 THEN 'electronics'
        WHEN 2 THEN 'clothing'
        WHEN 3 THEN 'food'
        WHEN 4 THEN 'books'
        ELSE 'other'
    END AS PRODUCT_CATEGORY,
    DATEADD(DAY, -UNIFORM(0, 365, RANDOM()), CURRENT_TIMESTAMP()) AS CREATED_AT
FROM TABLE(GENERATOR(ROWCOUNT => 2000));

CREATE OR REPLACE TABLE {database}.{raw_schema}.SUPPORT_TICKETS (
    TICKET_ID INT,
    CUSTOMER_ID INT,
    SUBJECT VARCHAR(500),
    BODY VARCHAR(5000),
    PRIORITY VARCHAR(20),
    STATUS VARCHAR(20),
    ASSIGNED_TO VARCHAR(100),
    CREATED_AT TIMESTAMP_NTZ DEFAULT CURRENT_TIMESTAMP(),
    RESOLVED_AT TIMESTAMP_NTZ
);

INSERT INTO {database}.{raw_schema}.SUPPORT_TICKETS
SELECT
    SEQ4() AS TICKET_ID,
    UNIFORM(0, 499, RANDOM()) AS CUSTOMER_ID,
    'Issue with order #' || UNIFORM(0, 1999, RANDOM())::VARCHAR AS SUBJECT,
    'Customer reported a problem with their recent order. Details: issue type ' ||
        UNIFORM(1, 10, RANDOM())::VARCHAR AS BODY,
    CASE UNIFORM(1, 3, RANDOM())
        WHEN 1 THEN 'high'
        WHEN 2 THEN 'medium'
        ELSE 'low'
    END AS PRIORITY,
    CASE UNIFORM(1, 3, RANDOM())
        WHEN 1 THEN 'open'
        WHEN 2 THEN 'in_progress'
        ELSE 'resolved'
    END AS STATUS,
    'agent_' || UNIFORM(1, 10, RANDOM())::VARCHAR AS ASSIGNED_TO,
    DATEADD(DAY, -UNIFORM(0, 180, RANDOM()), CURRENT_TIMESTAMP()) AS CREATED_AT,
    CASE WHEN UNIFORM(1, 3, RANDOM()) = 3
        THEN DATEADD(DAY, -UNIFORM(0, 30, RANDOM()), CURRENT_TIMESTAMP())
        ELSE NULL
    END AS RESOLVED_AT
FROM TABLE(GENERATOR(ROWCOUNT => 1000));
