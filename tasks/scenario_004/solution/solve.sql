USE ROLE {admin_role};
USE WAREHOUSE {warehouse};

CREATE OR REPLACE ROLE {raw_schema}_ANALYTICS_TEAM;
GRANT USAGE ON DATABASE {database} TO ROLE {raw_schema}_ANALYTICS_TEAM;
GRANT USAGE ON SCHEMA {database}.{raw_schema} TO ROLE {raw_schema}_ANALYTICS_TEAM;
GRANT SELECT ON ALL TABLES IN SCHEMA {database}.{raw_schema} TO ROLE {raw_schema}_ANALYTICS_TEAM;
GRANT USAGE ON SCHEMA {database}.{analytics_schema} TO ROLE {raw_schema}_ANALYTICS_TEAM;
GRANT SELECT ON ALL VIEWS IN SCHEMA {database}.{analytics_schema} TO ROLE {raw_schema}_ANALYTICS_TEAM;
GRANT SELECT ON FUTURE VIEWS IN SCHEMA {database}.{analytics_schema} TO ROLE {raw_schema}_ANALYTICS_TEAM;

CREATE OR REPLACE VIEW {database}.{analytics_schema}.CUSTOMER_SUMMARY AS
SELECT CUSTOMER_ID, CUSTOMER_NAME, EMAIL, CITY, STATE, CREATED_AT
FROM {database}.{raw_schema}.CUSTOMERS;

CREATE OR REPLACE VIEW {database}.{analytics_schema}.ORDER_SUMMARY AS
SELECT ORDER_DATE, PRODUCT_CATEGORY, COUNT(*) AS ORDER_COUNT,
       SUM(TOTAL_AMOUNT) AS REVENUE
FROM {database}.{raw_schema}.ORDERS GROUP BY ORDER_DATE, PRODUCT_CATEGORY;

CREATE OR REPLACE WAREHOUSE {raw_schema}_TEAM_WH
    WAREHOUSE_SIZE = 'X-SMALL' AUTO_SUSPEND = 60 AUTO_RESUME = TRUE INITIALLY_SUSPENDED = TRUE;
GRANT USAGE ON WAREHOUSE {raw_schema}_TEAM_WH TO ROLE {raw_schema}_ANALYTICS_TEAM;
