task_id: classify_005
status: ready
difficulty: simple
category: data-governance
domains: [data-policy]
description: Run SYSTEM$CLASSIFY on the CUSTOMERS table to auto-detect PII columns.
environment: support_tickets

steps:
  - step_id: 1
    type: prompt
    prompt: >
      Run SYSTEM$CLASSIFY on the {database}.{raw_schema}.CUSTOMERS table
      to automatically detect and tag PII columns with semantic categories.

requirements:
  - id: classify_ran
    description: At least one column has a SEMANTIC_CATEGORY tag after classification.
    check: sql
    query: |
      SELECT COUNT(*) AS ct FROM TABLE(
        INFORMATION_SCHEMA.TAG_REFERENCES(
          '{database}.{raw_schema}.CUSTOMERS', 'TABLE'
        )
      ) WHERE TAG_NAME = 'SEMANTIC_CATEGORY'
    pass_if: ct > 0

assertions:
  - id: ssn_tagged
    category: pii_discovery
    type: sql
    points: 2
    query: |
      SELECT COUNT(*) AS ct FROM TABLE(
        INFORMATION_SCHEMA.TAG_REFERENCES(
          '{database}.{raw_schema}.CUSTOMERS', 'TABLE'
        )
      ) WHERE TAG_NAME = 'SEMANTIC_CATEGORY' AND COLUMN_NAME = 'SSN'
    check: ct > 0
    description: SSN column detected as PII

  - id: email_tagged
    category: pii_discovery
    type: sql
    points: 2
    query: |
      SELECT COUNT(*) AS ct FROM TABLE(
        INFORMATION_SCHEMA.TAG_REFERENCES(
          '{database}.{raw_schema}.CUSTOMERS', 'TABLE'
        )
      ) WHERE TAG_NAME = 'SEMANTIC_CATEGORY' AND COLUMN_NAME = 'EMAIL'
    check: ct > 0
    description: EMAIL column detected as PII

traps: []
solution:
  scripts: [solve.sql]
