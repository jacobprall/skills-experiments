task_id: create_stream_012
status: ready
difficulty: simple
category: data-engineering
domains: [data-transformation]
description: Create a stream on the ORDERS table to track changes.
environment: support_tickets

steps:
  - step_id: 1
    type: prompt
    prompt: >
      Create an append-only stream on {database}.{raw_schema}.ORDERS called
      {staging_schema}.ORDERS_STREAM in the {database} database.

requirements:
  - id: stream_exists
    description: Stream was created.
    check: sql
    query: |
      SHOW STREAMS IN SCHEMA {database}.{staging_schema};
      SELECT COUNT(*) AS ct FROM TABLE(RESULT_SCAN(LAST_QUERY_ID()))
      WHERE "name" = 'ORDERS_STREAM';
    pass_if: ct > 0

assertions:
  - id: stream_is_append_only
    category: correctness
    type: sql
    points: 2
    query: |
      SHOW STREAMS IN SCHEMA {database}.{staging_schema};
      SELECT "mode" AS val FROM TABLE(RESULT_SCAN(LAST_QUERY_ID()))
      WHERE "name" = 'ORDERS_STREAM';
    check: val = APPEND_ONLY
    description: Stream is append-only mode

traps: []
solution:
  scripts: [solve.sql]
