USE ROLE {admin_role};
USE WAREHOUSE {warehouse};

CREATE OR REPLACE TABLE {database}.{staging_schema}.STG_CUSTOMERS AS
SELECT CUSTOMER_ID, TRIM(CUSTOMER_NAME) AS CUSTOMER_NAME, TRIM(EMAIL) AS EMAIL,
       TRIM(PHONE) AS PHONE, SSN, DATE_OF_BIRTH, TRIM(ADDRESS) AS ADDRESS,
       TRIM(CITY) AS CITY, UPPER(TRIM(STATE)) AS STATE, ZIP_CODE, CREATED_AT
FROM {database}.{raw_schema}.CUSTOMERS;

CREATE OR REPLACE TABLE {database}.{staging_schema}.STG_ORDERS AS
SELECT ORDER_ID, CUSTOMER_ID, ORDER_DATE::DATE AS ORDER_DATE,
       TOTAL_AMOUNT, UPPER(STATUS) AS STATUS,
       UPPER(PRODUCT_CATEGORY) AS PRODUCT_CATEGORY, CREATED_AT
FROM {database}.{raw_schema}.ORDERS;

CREATE OR REPLACE TABLE {database}.{staging_schema}.STG_SUPPORT_TICKETS AS
SELECT TICKET_ID, CUSTOMER_ID, SUBJECT, BODY, UPPER(PRIORITY) AS PRIORITY,
       UPPER(STATUS) AS STATUS, ASSIGNED_TO, CREATED_AT,
       CREATED_AT::DATE AS CREATED_DATE, RESOLVED_AT
FROM {database}.{raw_schema}.SUPPORT_TICKETS;
