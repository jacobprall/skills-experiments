task_id: data_quality_s04
status: ready
difficulty: standard
category: data-engineering
domains: [data-quality]
description: Create data quality checks using data metric functions.
environment: support_tickets

steps:
  - step_id: 1
    type: prompt
    prompt: >
      Create data quality monitoring for {database}.{raw_schema}.ORDERS:
      1. Create a view {analytics_schema}.ORDER_QUALITY_REPORT that checks
         for NULL values, duplicate ORDER_IDs, invalid STATUS values,
         and negative TOTAL_AMOUNT. Show counts for each issue type.

requirements:
  - id: quality_view
    description: Quality report view exists.
    check: sql
    query: |
      SELECT COUNT(*) AS ct FROM {database}.INFORMATION_SCHEMA.VIEWS
      WHERE TABLE_SCHEMA = '{analytics_schema}' AND TABLE_NAME = 'ORDER_QUALITY_REPORT'
    pass_if: ct > 0

assertions:
  - id: report_runs
    category: correctness
    type: sql
    points: 3
    query: |
      SELECT COUNT(*) AS ct FROM {database}.{analytics_schema}.ORDER_QUALITY_REPORT
    check: ct > 0
    description: Quality report returns results

traps: []
solution:
  scripts: [solve.sql]
