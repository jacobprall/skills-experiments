task_id: monitoring_setup_s10
status: ready
difficulty: standard
category: admin
domains: [cost-management, data-quality]
description: Set up monitoring views for query performance and warehouse usage.
environment: support_tickets

steps:
  - step_id: 1
    type: prompt
    prompt: >
      Create monitoring views in {database}.{analytics_schema}:
      1. SLOW_QUERIES — queries from the last 7 days taking > 60 seconds,
         showing query_id, warehouse_name, execution_time, query_text (first 200 chars)
      2. FAILED_QUERIES — failed queries from last 7 days with error info
      Use SNOWFLAKE.ACCOUNT_USAGE.QUERY_HISTORY.

requirements:
  - id: slow_queries_view
    description: SLOW_QUERIES view exists.
    check: sql
    query: |
      SELECT COUNT(*) AS ct FROM {database}.INFORMATION_SCHEMA.VIEWS
      WHERE TABLE_SCHEMA = '{analytics_schema}' AND TABLE_NAME = 'SLOW_QUERIES'
    pass_if: ct > 0

assertions:
  - id: failed_queries_view
    category: correctness
    type: sql
    points: 2
    query: |
      SELECT COUNT(*) AS ct FROM {database}.INFORMATION_SCHEMA.VIEWS
      WHERE TABLE_SCHEMA = '{analytics_schema}' AND TABLE_NAME = 'FAILED_QUERIES'
    check: ct > 0
    description: FAILED_QUERIES view exists

traps: []
solution:
  scripts: [solve.sql]
